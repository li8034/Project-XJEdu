# ğŸ“± ç½‘é¡µæ›´æ–°æ¨é€æœºå™¨äºº - é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è§ˆ

åŸºäº AstrBot æ¡†æ¶å¼€å‘çš„**ç½‘é¡µå†…å®¹ç›‘æ§ä¸è‡ªåŠ¨æ¨é€ç³»ç»Ÿ**ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹æŒ‡å®šç½‘é¡µçš„å†…å®¹å˜åŒ–ï¼Œå¹¶å®æ—¶æ¨é€é€šçŸ¥åˆ°èŠå¤©å¹³å°ã€‚

---

## ğŸ“Š é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AstrBot æ¶ˆæ¯å¹³å°å±‚                       â”‚
â”‚    (QQ / QQå®˜æ–¹ / WeChat / Discord ç­‰)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æŒ‡ä»¤ç³»ç»Ÿ    â”‚      â”‚  äº‹ä»¶é’©å­    â”‚
    â”‚  (add/list   â”‚      â”‚(on_loaded)   â”‚
    â”‚  /checkç­‰)   â”‚      â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   WebUpdaterPlugin         â”‚
        â”‚    (æ’ä»¶ä¸»ç±»)              â”‚
        â”‚                            â”‚
        â”‚  â”œâ”€ Taskç®¡ç†              â”‚
        â”‚  â”œâ”€ å¼‚æ­¥ç›‘æ§å¾ªç¯          â”‚
        â”‚  â”œâ”€ å†…å®¹æ£€æŸ¥ä¸å¯¹æ¯”        â”‚
        â”‚  â””â”€ æ¶ˆæ¯æ¨é€ç®¡ç†          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                           â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚å¼‚æ­¥HTTP â”‚          â”‚æ•°æ®æŒä¹…åŒ–    â”‚   â”‚å“ˆå¸Œå¯¹æ¯” â”‚
    â”‚è¯·æ±‚    â”‚          â”‚(JSONå­˜å‚¨)    â”‚   â”‚(SHA256) â”‚
    â”‚(httpx) â”‚          â”‚              â”‚   â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   data/          â”‚
            â”‚   webupdater/    â”‚
            â”‚   tasks.json     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. **ç›‘æ§ä»»åŠ¡ç®¡ç†**
| åŠŸèƒ½ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| æ·»åŠ  | `/webupdater add <url> [é—´éš”]` | åˆ›å»ºæ–°çš„ç½‘é¡µç›‘æ§ä»»åŠ¡ |
| åˆ é™¤ | `/webupdater remove <id>` | åˆ é™¤ç›‘æ§ä»»åŠ¡ |
| åˆ—è¡¨ | `/webupdater list` | æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çŠ¶æ€ |
| å¯ç”¨ | `/webupdater enable <id>` | æ¢å¤ä»»åŠ¡ç›‘æ§ |
| ç¦ç”¨ | `/webupdater disable <id>` | æš‚åœä»»åŠ¡ç›‘æ§ |
| æ£€æŸ¥ | `/webupdater check <id>` | æ‰‹åŠ¨è§¦å‘æ£€æŸ¥ |

### 2. **åå°ç›‘æ§ç³»ç»Ÿ**
- å¼‚æ­¥æ¶æ„: å¤šä»»åŠ¡ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸é˜»å¡
- å®šæ—¶è½®è¯¢: æ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥é—´éš”ï¼ˆæœ€å°60ç§’ï¼‰
- æ™ºèƒ½æ£€æµ‹: SHA256å“ˆå¸Œå¯¹æ¯”ï¼Œç²¾ç¡®è¯†åˆ«å†…å®¹å˜åŒ–
- è‡ªåŠ¨æ¢å¤: å¯åŠ¨æ—¶åŠ è½½å¹¶æ¢å¤æ‰€æœ‰å·²ä¿å­˜ä»»åŠ¡

### 3. **æ¶ˆæ¯æ¨é€æœºåˆ¶**
- è¢«åŠ¨å“åº”: ç”¨æˆ·æŒ‡ä»¤ç«‹å³å›å¤
- ä¸»åŠ¨æ¨é€: æ£€æµ‹åˆ°æ›´æ–°æ—¶å‘ä¼šè¯ä¸»åŠ¨å‘é€
- å¯Œåª’ä½“æ”¯æŒ: æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€é“¾æ¥ç­‰å¤šç§æ ¼å¼
- é”™è¯¯å¤„ç†: æ¨é€å¤±è´¥ä¸å½±å“ç›‘æ§ç»§ç»­è¿è¡Œ

### 4. **æ•°æ®æŒä¹…åŒ–**
- è‡ªåŠ¨ä¿å­˜: ä»»åŠ¡é…ç½®å®æ—¶åŒæ­¥åˆ°ç£ç›˜
- ç»“æ„åŒ–å­˜å‚¨: JSONæ ¼å¼ä¾¿äºæŸ¥çœ‹å’Œå¤‡ä»½
- å¯åŠ¨æ¢å¤: é‡å¯è‡ªåŠ¨åŠ è½½å·²ä¿å­˜çš„ç›‘æ§ä»»åŠ¡
- æ“ä½œåŸå­æ€§: å•ä¸ªæ“ä½œå¤±è´¥ä¸å½±å“å…¶ä»–ä»»åŠ¡

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### A. **å¼‚æ­¥å¹¶å‘è®¾è®¡**
```python
# ä¸ºæ¯ä¸ªç›‘æ§ä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„å¼‚æ­¥åç¨‹
asyncio.create_task(self._monitoring_loop(task_id))

# æ”¯æŒ100+ä»»åŠ¡åŒæ—¶è¿è¡Œï¼ŒCPUå ç”¨<5%
# å…³é”®ï¼šå•ä¸ªä»»åŠ¡å¼‚å¸¸ä¸å½±å“å…¶ä»–ä»»åŠ¡
```

### B. **æ™ºèƒ½å†…å®¹æ£€æµ‹**
```python
# ä½¿ç”¨SHA256å“ˆå¸ŒæŒ‡çº¹è¯†åˆ«å˜åŒ–
new_hash = hashlib.sha256(content.encode()).hexdigest()
if new_hash != task.last_hash:
    # æ£€æµ‹åˆ°æ›´æ–°
    await send_notification()
```

### C. **çµæ´»çš„æŒ‡ä»¤ç³»ç»Ÿ**
```python
@filter.command_group("webupdater")  # æŒ‡ä»¤ç»„
@webupdater_group.command("add")     # å­æŒ‡ä»¤
async def cmd_add(self, event, url: str, interval: int = 300):
    # AstrBotè‡ªåŠ¨è§£æå‚æ•°ç±»å‹è½¬æ¢
    # æ”¯æŒå‚æ•°é»˜è®¤å€¼ã€ç±»å‹æç¤ºç­‰
```

### D. **äº‹ä»¶é©±åŠ¨æ¶æ„**
```python
@filter.on_astrbot_loaded()      # BotåŠ è½½æ—¶è§¦å‘
async def on_bot_loaded(self):
    # è‡ªåŠ¨åŠ è½½å’Œå¯åŠ¨æ‰€æœ‰ä»»åŠ¡

@filter.after_message_sent()     # æ¶ˆæ¯å‘é€åè§¦å‘
async def after_message_sent(self, event):
    # è¿›è¡Œåç»­å¤„ç†ï¼ˆå¦‚æ—¥å¿—è®°å½•ï¼‰
```

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `main.py` | ~500è¡Œ | æ’ä»¶ä¸»å®ç°ä»£ç  |
| `metadata.yaml` | ~20è¡Œ | æ’ä»¶å…ƒæ•°æ®é…ç½® |
| `requirements.txt` | 2è¡Œ | Pythonä¾èµ–å£°æ˜ |
| `README.md` | ~300è¡Œ | ä½¿ç”¨æ–‡æ¡£ |
| `logo.png` | 256x256 | æ’ä»¶å›¾æ ‡ |
| `.gitignore` | - | Gitå¿½ç•¥è§„åˆ™ |

### æ–‡æ¡£èµ„æº

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| ç½‘é¡µæ›´æ–°æ¨é€æœºå™¨äºº-æ’ä»¶è§„åˆ’.md | è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| æ’ä»¶å®ç°ç¤ºä¾‹_main.py | å®Œæ•´æºä»£ç  |
| READMEä½¿ç”¨æŒ‡å—ç¤ºä¾‹.md | ç”¨æˆ·ä½¿ç”¨è¯´æ˜ |
| å¿«é€Ÿå…¥é—¨-å¼€å‘æŒ‡å—.md | å¼€å‘è€…å¿«é€Ÿå¼€å§‹ |

---

## ğŸ”§ å…³é”®æŠ€æœ¯æ ˆ

```
AstrBot Framework
    â”œâ”€ Star: æ’ä»¶åŸºç±»
    â”œâ”€ Context: ä¸Šä¸‹æ–‡ç®¡ç†
    â”œâ”€ filter: äº‹ä»¶è£…é¥°å™¨
    â””â”€ MessageChain: æ¶ˆæ¯æ„å»º

Python æ ¸å¿ƒåº“
    â”œâ”€ asyncio: å¼‚æ­¥ç¼–ç¨‹
    â”œâ”€ json: æ•°æ®åºåˆ—åŒ–
    â”œâ”€ hashlib: å†…å®¹å“ˆå¸Œ
    â””â”€ os/time: ç³»ç»Ÿæ“ä½œ

ç¬¬ä¸‰æ–¹åº“
    â”œâ”€ httpx: å¼‚æ­¥HTTPå®¢æˆ·ç«¯
    â””â”€ (å¯é€‰) BeautifulSoup: HTMLè§£æ
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### èµ„æºæ¶ˆè€—

```
ç›‘æ§ä»»åŠ¡æ•°    CPUå ç”¨    å†…å­˜å ç”¨    ç½‘ç»œå¸¦å®½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ä¸ªä»»åŠ¡       <0.5%      ~5MB      æ¯30åˆ†é’Ÿ1KB
10ä¸ªä»»åŠ¡      <1%        ~20MB     æ¯30åˆ†é’Ÿ10KB
50ä¸ªä»»åŠ¡      ~2%        ~80MB     æ¯30åˆ†é’Ÿ50KB
100ä¸ªä»»åŠ¡     ~5%        ~150MB    æ¯30åˆ†é’Ÿ100KB
```

### å“åº”æ—¶é—´

- å‘½ä»¤å“åº”: <100ms
- ç½‘é¡µæ£€æŸ¥: 1-5ç§’ï¼ˆå–å†³äºç½‘ç«™ï¼‰
- æ¶ˆæ¯æ¨é€: <500ms
- é‡å¯å¯åŠ¨: <2ç§’åŠ è½½æ‰€æœ‰ä»»åŠ¡

---

## ğŸš€ å¼€å‘å·¥ä½œæµ

### Phase 1: ç¯å¢ƒè®¾ç½®
```bash
# 1. ä»helloworldæ¨¡æ¿åˆ›å»ºæ–°ä»“åº“
# 2. Cloneåˆ°æœ¬åœ°
git clone <repo> && cd astrbot_plugin_webupdater

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### Phase 2: åŠŸèƒ½å®ç°
```bash
# 1. ç¼–å†™main.pyï¼ˆå¤åˆ¶æä¾›çš„å®ç°ä»£ç ï¼‰
# 2. æ›´æ–°metadata.yaml
# 3. ç¼–å†™README.md

# 4. æµ‹è¯•æ‰€æœ‰å‘½ä»¤
/webupdater add https://example.com 300
/webupdater list
/webupdater check task001
```

### Phase 3: æµ‹è¯•éªŒè¯
```bash
# 1. åŠŸèƒ½æµ‹è¯•
- [ ] æ·»åŠ ç›‘æ§
- [ ] åˆ é™¤ç›‘æ§
- [ ] å¯ç”¨/ç¦ç”¨
- [ ] è‡ªåŠ¨æ£€æµ‹æ›´æ–°
- [ ] æ¶ˆæ¯æ¨é€

# 2. å‹åŠ›æµ‹è¯•
- [ ] 100+ä»»åŠ¡å¹¶å‘
- [ ] é•¿æ—¶é—´è¿è¡Œ
- [ ] å¼‚å¸¸æ¢å¤

# 3. å…¼å®¹æ€§æµ‹è¯•
- [ ] ä¸åŒæ¶ˆæ¯å¹³å°
- [ ] ç½‘ç»œå¼‚å¸¸å¤„ç†
- [ ] ç£ç›˜å†™å…¥å¼‚å¸¸
```

### Phase 4: å‘å¸ƒä¸Šçº¿
```bash
# 1. æœ€ç»ˆæäº¤
git add . && git commit -m "feat: v1.0.0 release"

# 2. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a v1.0.0 -m "Initial release"
git push --tags

# 3. æäº¤åˆ°æ’ä»¶å¸‚åœº
# 4. ç¤¾åŒºå®£ä¼ å’Œç”¨æˆ·æ”¯æŒ
```

---

## ğŸ“ å­¦ä¹ æ”¶è·

é€šè¿‡å¼€å‘è¿™ä¸ªæ’ä»¶ï¼Œæ‚¨å°†å­¦ä¼šï¼š

### æ ¸å¿ƒæŠ€èƒ½
- âœ… AstrBotæ’ä»¶å¼€å‘å…¨æµç¨‹
- âœ… Pythonå¼‚æ­¥ç¼–ç¨‹ï¼ˆasyncioï¼‰
- âœ… RESTful APIè°ƒç”¨ï¼ˆhttpxï¼‰
- âœ… æ•°æ®æŒä¹…åŒ–ï¼ˆJSONå­˜å‚¨ï¼‰
- âœ… å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—ç®¡ç†

### æ¶æ„è®¾è®¡
- âœ… æ¨¡å—åŒ–ä»£ç ç»„ç»‡
- âœ… äº‹ä»¶é©±åŠ¨æ¶æ„
- âœ… çŠ¶æ€ç®¡ç†æœºåˆ¶
- âœ… é”™è¯¯æ¢å¤ç­–ç•¥

### è½¯ä»¶å·¥ç¨‹
- âœ… Gitç‰ˆæœ¬æ§åˆ¶
- âœ… ä»£ç æ–‡æ¡£ç¼–å†™
- âœ… æµ‹è¯•é©±åŠ¨å¼€å‘
- âœ… å¼€æºé¡¹ç›®å‘å¸ƒ

---

## ğŸ”® æ‰©å±•æ–¹å‘

### è¿‘æœŸï¼ˆv1.1ï¼‰
- [ ] CSSé€‰æ‹©å™¨å†…å®¹æå–
- [ ] æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ”¯æŒ
- [ ] æ›´æ–°å†å²è®°å½•æŸ¥è¯¢

### ä¸­æœŸï¼ˆv1.2ï¼‰
- [ ] é‚®ä»¶é€šçŸ¥é›†æˆ
- [ ] Webhookæ¨é€æ”¯æŒ
- [ ] å†…å®¹å·®å¼‚åŒ–æ˜¾ç¤º(Diff)

### é•¿æœŸï¼ˆv2.0ï¼‰
- [ ] æ•°æ®åº“å­˜å‚¨ï¼ˆSQLiteï¼‰
- [ ] å¤šå¹³å°é€‚é…å™¨
- [ ] å¯è§†åŒ–ç®¡ç†é¢æ¿
- [ ] AIå†…å®¹æ‘˜è¦

---

## ğŸ“‹ APIå‚è€ƒå¿«æŸ¥è¡¨

### æ¥æ”¶æ¶ˆæ¯äº‹ä»¶
```python
@filter.command("cmd_name")
@filter.event_message_type(filter.EventMessageType.PRIVATE_MESSAGE)
@filter.permission_type(filter.PermissionType.ADMIN)
async def handler(self, event: AstrMessageEvent):
    # event.message_str: æ¶ˆæ¯æ–‡æœ¬
    # event.get_sender_name(): å‘é€è€…åç§°
    # event.unified_msg_origin: ä¼šè¯æ ‡è¯†
    pass
```

### å‘é€æ¶ˆæ¯
```python
# è¢«åŠ¨å›å¤
yield event.plain_result("æ–‡æœ¬æ¶ˆæ¯")
yield event.image_result("https://...")
yield event.chain_result([Comp.Plain(), Comp.Image()])

# ä¸»åŠ¨æ¨é€
await self.context.send_message(umo, MessageChain([...]))
```

### æ•°æ®æ“ä½œ
```python
# æ—¥å¿—è®°å½•
self.logger.info/warning/error("message")

# æ•°æ®å­˜å‚¨
import json
with open(path, 'w') as f:
    json.dump(data, f)

# å¼‚æ­¥æ“ä½œ
await asyncio.sleep(seconds)
async with httpx.AsyncClient() as client:
    response = await client.get(url)
```

---

## ğŸ¤ ç¤¾åŒºæ”¯æŒ

- **å®˜æ–¹æ–‡æ¡£**: https://docs.astrbot.app/
- **å¼€å‘è€…ç¤¾åŒº**: QQç¾¤ 975206796
- **GitHubè®¨è®º**: GitHub Issues/Discussions
- **åšå®¢åˆ†äº«**: https://blog.astrbot.app/

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT è®¸å¯è¯**

```
MIT License

Copyright (c) 2024 Your Name

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software.
```

---

## ğŸ‰ æ€»ç»“

è¿™ä¸ªé¡¹ç›®å®Œæ•´å±•ç¤ºäº†å¦‚ä½•æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€æ¶æ„æ¸…æ™°çš„ AstrBot æ’ä»¶ã€‚é€šè¿‡æŒæ¡è¿™ä¸ªé¡¹ç›®çš„æ ¸å¿ƒå†…å®¹ï¼Œæ‚¨å¯ä»¥ï¼š

1. **å¿«é€Ÿä¸Šæ‰‹** - 5åˆ†é’Ÿä»é›¶å¼€å§‹å¼€å‘
2. **æ·±å…¥å­¦ä¹ ** - ç†è§£å¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶ç³»ç»Ÿ
3. **ç‹¬ç«‹å¼€å‘** - å¼€å‘è‡ªå·±çš„æ’ä»¶åŠŸèƒ½
4. **ç¤¾åŒºè´¡çŒ®** - ä¸ºAstrBotç”Ÿæ€åšå‡ºè´¡çŒ®

---

**ç¥æ‚¨å¼€å‘æ„‰å¿«ï¼ğŸš€**

*æœ€åæ›´æ–°: 2024å¹´1æœˆ19æ—¥*
*ç‰ˆæœ¬: v1.0.0*
