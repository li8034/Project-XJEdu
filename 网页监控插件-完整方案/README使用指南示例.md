# ç½‘é¡µæ›´æ–°ç›‘æ§æ’ä»¶ - ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸º AstrBot è®¾è®¡çš„ç½‘é¡µå†…å®¹ç›‘æ§æ’ä»¶ï¼Œèƒ½å¤Ÿï¼š
- âœ… è‡ªåŠ¨å®šæœŸæ£€æŸ¥æŒ‡å®šç½‘é¡µçš„å†…å®¹å˜åŒ–
- âœ… æ£€æµ‹åˆ°æ›´æ–°æ—¶ä¸»åŠ¨æ¨é€æ¶ˆæ¯é€šçŸ¥
- âœ… æ”¯æŒå¤šä¸ªç½‘é¡µåŒæ—¶ç›‘æ§
- âœ… çµæ´»ç®¡ç†ç›‘æ§ä»»åŠ¡ï¼ˆå¯ç”¨/ç¦ç”¨/åˆ é™¤ï¼‰
- âœ… é…ç½®è‡ªåŠ¨åŒ–æŒä¹…åŒ–ï¼Œé‡å¯è‡ªåŠ¨æ¢å¤

## åŠŸèƒ½ç‰¹æ€§

### 1. ç›‘æ§ç®¡ç†
| åŠŸèƒ½ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| æ·»åŠ ç›‘æ§ | `/webupdater add <url> [é—´éš”]` | æ·»åŠ æ–°çš„ç½‘é¡µç›‘æ§ä»»åŠ¡ |
| åˆ é™¤ç›‘æ§ | `/webupdater remove <ä»»åŠ¡ID>` | åˆ é™¤æŒ‡å®šçš„ç›‘æ§ä»»åŠ¡ |
| æŸ¥çœ‹åˆ—è¡¨ | `/webupdater list` | æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒç›‘æ§ä»»åŠ¡ |
| å¯ç”¨ä»»åŠ¡ | `/webupdater enable <ä»»åŠ¡ID>` | å¯ç”¨å·²ç¦ç”¨çš„ä»»åŠ¡ |
| ç¦ç”¨ä»»åŠ¡ | `/webupdater disable <ä»»åŠ¡ID>` | ç¦ç”¨æ´»è·ƒä»»åŠ¡ |
| æ‰‹åŠ¨æ£€æŸ¥ | `/webupdater check <ä»»åŠ¡ID>` | ç«‹å³æ£€æŸ¥æŒ‡å®šä»»åŠ¡ |

### 2. æŠ€æœ¯ç‰¹æ€§
- **å¼‚æ­¥è®¾è®¡**: å¤šä¸ªç›‘æ§ä»»åŠ¡ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸é˜»å¡
- **æ™ºèƒ½æ›´æ–°æ£€æµ‹**: ä½¿ç”¨SHA256å“ˆå¸Œå¯¹æ¯”ï¼Œç²¾ç¡®è¯†åˆ«å†…å®¹å˜åŒ–
- **æ•°æ®æŒä¹…åŒ–**: ä»»åŠ¡é…ç½®è‡ªåŠ¨ä¿å­˜ï¼Œé‡å¯åè‡ªåŠ¨æ¢å¤
- **é”™è¯¯å¤„ç†**: å•ä¸ªä»»åŠ¡å¼‚å¸¸ä¸å½±å“å…¶ä»–ä»»åŠ¡è¿è¡Œ
- **æ€§èƒ½ä¼˜åŒ–**: å¯é…ç½®æ£€æŸ¥é—´éš”ï¼Œæ§åˆ¶èµ„æºæ¶ˆè€—

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ç›‘æ§GitHubå‘å¸ƒé¡µé¢

```
ç”¨æˆ·: /webupdater add https://github.com/AstrBotDevs/AstrBot/releases 3600
æœºå™¨äºº: âœ… å·²æ·»åŠ ç›‘æ§ä»»åŠ¡ `abc12345`
       ğŸ“ URL: https://github.com/AstrBotDevs/AstrBot/releases
       â±ï¸ æ£€æŸ¥é—´éš”: 3600ç§’

[1å°æ—¶åï¼Œæœ‰æ–°å‘å¸ƒ]

æœºå™¨äºº: ğŸ“¢ æ£€æµ‹åˆ°ç½‘é¡µæ›´æ–°ï¼
       â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       ğŸ”— URL: https://github.com/AstrBotDevs/AstrBot/releases
       â° æ—¶é—´: 2024-01-19 15:30:00
       â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       ğŸ“ æ ‡é¢˜: Release v4.11.0
       ğŸ“„ æ‘˜è¦: New features and bug fixes...
```

### ç¤ºä¾‹2: ç®¡ç†å¤šä¸ªç›‘æ§ä»»åŠ¡

```
ç”¨æˆ·: /webupdater list
æœºå™¨äºº: ğŸ“‹ ç½‘é¡µç›‘æ§ä»»åŠ¡åˆ—è¡¨
       â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
       
       âœ… ä»»åŠ¡ID: task001
          URL: https://github.com/AstrBotDevs/AstrBot/releases
          æ£€æŸ¥é—´éš”: 3600ç§’
          ä¸‹æ¬¡æ£€æŸ¥: 15:45:30
       
       â¸ï¸ ä»»åŠ¡ID: task002
          URL: https://blog.example.com
          æ£€æŸ¥é—´éš”: 1800ç§’
          çŠ¶æ€: å·²ç¦ç”¨

ç”¨æˆ·: /webupdater enable task002
æœºå™¨äºº: âœ… å·²å¯ç”¨ä»»åŠ¡ `task002`
```

### ç¤ºä¾‹3: ç›‘æ§é¢‘ç‡è®¾ç½®

```
# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ˆé€‚åˆé«˜é¢‘æ›´æ–°çš„é¡µé¢ï¼‰
/webupdater add https://example.com/feed 300

# æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼ˆæ™®é€šé¡µé¢ï¼‰
/webupdater add https://example.com/news 1800

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼ˆä½é¢‘æ›´æ–°é¡µé¢ï¼‰
/webupdater add https://example.com/blog 3600

# æ¯å¤©æ£€æŸ¥ä¸€æ¬¡ï¼ˆæ—¥æ›´æ–°å†…å®¹ï¼‰
/webupdater add https://example.com/daily 86400
```

## å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AstrBot å¯åŠ¨æ—¶ (on_astrbot_loaded) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  åŠ è½½ä¿å­˜çš„ä»»åŠ¡åˆ—è¡¨  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  ä¸ºæ¯ä¸ªå¯ç”¨çš„ä»»åŠ¡å¯åŠ¨å¼‚æ­¥    â”‚
      â”‚     ç›‘æ§åç¨‹ (Task)        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  åœ¨åå°å¾ªç¯è¿è¡Œ(intervalé—´éš”)    â”‚
      â”‚  1. è·å–ç½‘é¡µå†…å®¹                 â”‚
      â”‚  2. è®¡ç®—SHA256å“ˆå¸Œ               â”‚
      â”‚  3. ä¸last_hashå¯¹æ¯”              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
               â”‚ æœ‰æ›´æ–°                 â”‚ æ— æ›´æ–°
               â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ„å»ºæ¨é€æ¶ˆæ¯    â”‚      â”‚ ç­‰å¾…ä¸‹ä¸ªé—´éš”  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ é€šè¿‡context.send   â”‚
        â”‚ _messageä¸»åŠ¨æ¨é€    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ç”¨æˆ·æ”¶åˆ°æ¨é€æ¶ˆæ¯   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é…ç½®è¯¦è§£

### ä»»åŠ¡å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|------|
| url | str | - | è¦ç›‘æ§çš„ç½‘é¡µURL (å¿…é¡»ä»¥http/httpså¼€å¤´) |
| interval | int | â‰¥60 | æ£€æŸ¥é—´éš”ï¼Œå•ä½ç§’ï¼Œæœ€å°60ç§’ |
| task_id | str | - | ä»»åŠ¡å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| enabled | bool | true/false | ä»»åŠ¡æ˜¯å¦å¯ç”¨ |
| unified_msg_origin | str | - | æ¨é€æ¶ˆæ¯ç›®æ ‡ä¼šè¯ |
| last_hash | str | - | ä¸Šæ¬¡æ£€æŸ¥çš„å†…å®¹å“ˆå¸Œå€¼ |
| last_check_time | int | - | æœ€åæ£€æŸ¥çš„æ—¶é—´æˆ³ |

### æ¨èé…ç½®

```
# è½»é‡çº§ç›‘æ§ï¼ˆèµ„æºæ¶ˆè€—å°ï¼‰
- æ£€æŸ¥é—´éš”: 1å°æ—¶ (3600ç§’)
- é€‚ç”¨: åšå®¢ã€æ–‡æ¡£ã€æ–°é—»ç½‘ç«™

# æ ‡å‡†ç›‘æ§ï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰
- æ£€æŸ¥é—´éš”: 30åˆ†é’Ÿ (1800ç§’)  
- é€‚ç”¨: å¤§å¤šæ•°å¸¸è§„ç½‘é¡µ

# é«˜é¢‘ç›‘æ§ï¼ˆå®æ—¶æ›´æ–°ï¼‰
- æ£€æŸ¥é—´éš”: 5åˆ†é’Ÿ (300ç§’)
- é€‚ç”¨: è®ºå›ã€åŠ¨æ€æ›´æ–°çš„é¡µé¢
- æ³¨æ„: ä¼šå¢åŠ æœåŠ¡å™¨å’Œç½‘ç«™çš„è´Ÿè½½

# è¶…è½»é‡ç›‘æ§ï¼ˆæ¯å¤©ï¼‰
- æ£€æŸ¥é—´éš”: 1å¤© (86400ç§’)
- é€‚ç”¨: ä¸éœ€è¦å®æ—¶æ›´æ–°çš„å†…å®¹
```

## æ•°æ®å­˜å‚¨

æ’ä»¶çš„æ•°æ®å­˜å‚¨åœ¨ AstrBot çš„ `data` ç›®å½•ä¸‹ï¼š

```
data/
â””â”€â”€ webupdater/
    â””â”€â”€ tasks.json          # æ‰€æœ‰ç›‘æ§ä»»åŠ¡çš„é…ç½®
```

### tasks.json æ ¼å¼ç¤ºä¾‹

```json
{
  "tasks": [
    {
      "id": "abc12345",
      "url": "https://github.com/AstrBotDevs/AstrBot/releases",
      "interval": 3600,
      "enabled": true,
      "unified_msg_origin": "qguild:123456:789012",
      "last_hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
      "last_check_time": 1705675800,
      "created_time": 1705672200
    },
    {
      "id": "def67890",
      "url": "https://blog.example.com",
      "interval": 1800,
      "enabled": false,
      "unified_msg_origin": "qq:987654321",
      "last_hash": "",
      "last_check_time": 0,
      "created_time": 1705668600
    }
  ]
}
```

## æ•…éšœæ’é™¤

### é—®é¢˜1: æ·»åŠ ç›‘æ§åæ²¡æœ‰æ”¶åˆ°æ›´æ–°æ¨é€

**å¯èƒ½åŸå› :**
1. URLä¸å¯è®¿é—®æˆ–è¿”å›é200çŠ¶æ€ç 
2. æ£€æŸ¥é—´éš”å¤ªé•¿ï¼Œè¿˜æ²¡åˆ°æ£€æŸ¥æ—¶é—´
3. ç½‘é¡µå†…å®¹å®é™…æ²¡æœ‰å˜åŒ–

**è§£å†³æ–¹æ¡ˆ:**
```
# ä½¿ç”¨ check å‘½ä»¤æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
/webupdater check <task_id>

# æŸ¥çœ‹æ˜¯å¦è¿”å›æ›´æ–°ä¿¡æ¯
# å¦‚æœè¿”å›"æš‚æ— æ›´æ–°"ï¼Œè¯´æ˜ç½‘é¡µæ²¡æœ‰å˜åŒ–

# ä½¿ç”¨è¾ƒçŸ­çš„é—´éš”é‡æ–°æ·»åŠ æµ‹è¯•
/webupdater add <url> 60  # 60ç§’æ£€æŸ¥ä¸€æ¬¡
```

### é—®é¢˜2: æ˜¾ç¤º"æ— æ•ˆçš„URL"

**åŸå› :** URLä¸ç¬¦åˆè¦æ±‚

**è§£å†³æ–¹æ¡ˆ:**
- URLå¿…é¡»ä»¥ `http://` æˆ– `https://` å¼€å¤´
- ç¡®ä¿URLå®Œæ•´ä¸”ä¸åŒ…å«ç©ºæ ¼
- æ­£ç¡®: `https://example.com/page`
- é”™è¯¯: `example.com/page` æˆ– `http://exa mple.com`

### é—®é¢˜3: æ£€æŸ¥é—´éš”è®¾ç½®å¤±è´¥

**åŸå› :** é—´éš”å¤ªçŸ­

**è§£å†³æ–¹æ¡ˆ:**
- æœ€å°æ£€æŸ¥é—´éš”ä¸º 60 ç§’
- å¦‚éœ€æ›´é«˜é¢‘ç‡ç›‘æ§ï¼Œè€ƒè™‘ä½¿ç”¨ä¸“ä¸šç½‘é¡µç›‘æ§æœåŠ¡

### é—®é¢˜4: é‡å¯åç›‘æ§ä»»åŠ¡æ¶ˆå¤±

**åŸå› :** è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œè¯´æ˜æœ‰bug

**æ’æŸ¥æ­¥éª¤:**
1. æ£€æŸ¥ `data/webupdater/tasks.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æŸ¥çœ‹æ’ä»¶æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ `data` ç›®å½•æœ‰å†™å…¥æƒé™
4. å°è¯•é‡æ–°æ·»åŠ ä»»åŠ¡å¹¶é‡å¯

## é«˜çº§ç”¨æ³•

### ç›‘æ§ç‰¹å®šå†…å®¹æ›´æ–°

è™½ç„¶å½“å‰ç‰ˆæœ¬ç›‘æ§æ•´ä¸ªç½‘é¡µï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç›‘æ§ç‰¹å®šå†…å®¹ï¼š

1. **ä½¿ç”¨ç½‘é¡µçš„APIç«¯ç‚¹** (æ¨è)
   ```
   /webupdater add https://api.example.com/latest 300
   ```

2. **ç›‘æ§RSS/Feed**
   ```
   /webupdater add https://example.com/feed.xml 600
   ```

3. **ç›‘æ§JSONæ•°æ®**
   ```
   /webupdater add https://example.com/api/status.json 900
   ```

### ä¸å…¶ä»–æ’ä»¶åä½œ

å¯ä»¥åœ¨æ’ä»¶äº‹ä»¶é’©å­ä¸­è°ƒç”¨è¯¥æ’ä»¶çš„åŠŸèƒ½ï¼š

```python
from webupdater import WebUpdaterPlugin

# åœ¨å…¶ä»–æ’ä»¶ä¸­è·å–ç›‘æ§çŠ¶æ€
updater = self.context.get_plugin("webupdater")
tasks = updater.tasks
```

## å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: åšå®¢æ›´æ–°æé†’
```
/webupdater add https://your-blog.com 86400  # æ¯å¤©æ£€æŸ¥ä¸€æ¬¡
```

### åœºæ™¯2: GitHubé¡¹ç›®å‘å¸ƒè·Ÿè¸ª
```
/webupdater add https://github.com/username/project/releases 3600
```

### åœºæ™¯3: ä»·æ ¼ç›‘æ§
```
/webupdater add https://shopping-site.com/product 600  # æ¯10åˆ†é’Ÿæ£€æŸ¥
```

### åœºæ™¯4: è®¢é˜…å†…å®¹æ›´æ–°
```
/webupdater add https://example.com/articles 1800  # æ¯30åˆ†é’Ÿæ£€æŸ¥
```

## æ€§èƒ½æŒ‡æ ‡

### èµ„æºæ¶ˆè€—ä¼°ç®—

| ç›‘æ§æ•°é‡ | CPUå ç”¨ | å†…å­˜å ç”¨ | ç½‘ç»œå¸¦å®½ |
|--------|--------|--------|---------|
| 1ä»»åŠ¡  | <1%    | ~5MB   | æä½    |
| 10ä»»åŠ¡ | <2%    | ~20MB  | ä½      |
| 100ä»»åŠ¡| ~5%    | ~100MB | ä¸­ç­‰    |

### æœ€ä¼˜å®è·µ

1. **é—´éš”è®¾ç½®**
   - é‡è¦é¡µé¢: 5-15åˆ†é’Ÿ
   - æ™®é€šé¡µé¢: 30-60åˆ†é’Ÿ
   - ä½ä¼˜å…ˆçº§: 1-2å°æ—¶æˆ–æ¯å¤©

2. **ä»»åŠ¡æ•°é‡**
   - æ¨èåŒæ—¶ç›‘æ§ â‰¤ 50 ä¸ªä»»åŠ¡
   - å¦‚éœ€æ›´å¤šï¼Œè€ƒè™‘åˆ†å¸ƒå¼éƒ¨ç½²

3. **å†…å­˜ç®¡ç†**
   - å®šæœŸæ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - åˆ é™¤ä¸å†éœ€è¦çš„ç›‘æ§ä»»åŠ¡

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-19)
- âœ… åŸºç¡€ç½‘é¡µç›‘æ§åŠŸèƒ½
- âœ… å¼‚æ­¥åå°æ£€æŸ¥æœºåˆ¶
- âœ… ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨
- âœ… çµæ´»çš„ä»»åŠ¡ç®¡ç†å‘½ä»¤
- âœ… ä¸»åŠ¨æ¶ˆæ¯æ¨é€

### è®¡åˆ’ä¸­çš„åŠŸèƒ½ (v1.1+)
- [ ] CSSé€‰æ‹©å™¨å†…å®¹æå–
- [ ] æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
- [ ] é‚®ä»¶é€šçŸ¥é›†æˆ
- [ ] Webhookæ”¯æŒ
- [ ] æ›´æ–°å†å²è®°å½•
- [ ] å·®å¼‚åŒ–å±•ç¤º(Diff)

## è·å–å¸®åŠ©

- ğŸ“– å®˜æ–¹æ–‡æ¡£: https://docs.astrbot.app/
- ğŸ’¬ AstrBotç¤¾åŒº: QQç¾¤ 975206796
- ğŸ› æŠ¥å‘Šé—®é¢˜: GitHub Issues
- ğŸ’¡ åŠŸèƒ½å»ºè®®: GitHub Discussions

## è®¸å¯è¯

æœ¬æ’ä»¶éµå¾ª MIT è®¸å¯è¯ã€‚

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
